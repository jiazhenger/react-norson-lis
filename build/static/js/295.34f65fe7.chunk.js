(this["webpackJsonpreact-my"]=this["webpackJsonpreact-my"]||[]).push([[295],{477:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return v}));var a=n(5),s=n(22),r=n(23),c=n(27),i=n(25),l=n(24),o=n(0),u=n.n(o),d=window,f=d.$http,h=d.$fn,b=d.$async,p=b((function(){return Promise.all([n.e(0),n.e(2),n.e(1),n.e(3),n.e(13)]).then(n.bind(null,94))})),m=Promise.all([n.e(0),n.e(2),n.e(1),n.e(14)]).then(n.bind(null,123)),j=b((function(){return Promise.all([n.e(0),n.e(2),n.e(1),n.e(3),n.e(17)]).then(n.bind(null,146))})),_=b((function(){return n.e(5).then(n.bind(null,135))})),g=b((function(){return Promise.all([n.e(0),n.e(1),n.e(4),n.e(11)]).then(n.bind(null,133))})),v=function(e){Object(i.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(s.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={data:[],selectedKeys:[],sf_code:"",sf_data:{sf_number:"",project_name:"",total_capacity:""},infoLoading:!1,pullLoading:!1,key:0},e.sf_list=[{name:"\u6807\u672c\u67b6\u7f16\u53f7",field:"sf_number"},{name:"\u79d1\u5ba4",field:"project_name"},{name:"\u5bb9\u91cf",field:"total_capacity"}],e.model={},e.querySpecPlane=function(){var t={sf_code:e.state.sf_code};f.submit(Object(c.a)(e),"shelf/use",{param:t,submitLoading:"infoLoading"}).then((function(t){e.setState({sf_data:t}),e.changeTableData(e.state.data,t.project_id),m.then((function(e){return e.default.success("\u64cd\u4f5c\u6210\u529f")}))}))},e.setArr=function(e,t){var n=e.filter((function(e){return e===t}));return!(!n||!n.length)},e.fetch=function(){var t={spec_codes:JSON.stringify(e.state.spec_enter_value)};f.submit(Object(c.a)(e),"shelf/validshelfbatch",{param:t,submitLoading:"pullLoading"}).then((function(t){var n=e.state.data,a=e.state.data.map((function(e){return e.uuid}));t.forEach((function(t){e.setArr(a,t.uuid)||(a.push(t.uuid),n.push(t))})),e.changeTableData(n,e.state.sf_data.project_id)}))},e.changeTableData=function(t,n){console.log("\u5224\u65ad\u4e0a\u67b6\u72b6\u6001"),t.forEach((function(e,t){e._id=t+1,"1"!==String(e.audit_status)||"1"!==String(e.is_receive)?e._status="3":"1"===String(e.spec_status)?e._status="2":n&&n===e.job_id?e._status="1":e._status="0"})),console.log(t),e.setState({data:t,key:e.state.key+1})},e.onCompletion=function(){var t=e.state.data.filter((function(e){return"1"===e._status})).map((function(e){var t={};for(var n in e)"_status"===n||"is_checked"===n||"_id"===n||(t[n]=e[n]);return t}));console.log(t),e.state.sf_data.sf_number&&h.hasArray(t)?f.submit(Object(c.a)(e),"shelf/upshelfbatch",{param:{data:t,sf_number:e.state.sf_data.sf_number},submitLoading:"pullLoading"}).then((function(t){var n=e.state.data.filter((function(e){return"1"!==e._status}));e.setState({data:n,selectedKeys:[]})})):e.state.sf_data.sf_number?h.hasArray(t)||m.then((function(e){return e.default.error("\u672a\u627e\u5230\u4e0e\u6807\u672c\u67b6\u5339\u914d\u7684\u6761\u7801")})):m.then((function(e){return e.default.error("\u6807\u672c\u67b6\u7f16\u53f7\u4e0d\u80fd\u4e3a\u7a7a")}))},e.deletes=function(t){var n=e.state,a=n.data,s=n.selectedKeys;if(1===t){var r=[];a.forEach((function(e){var t=s.filter((function(t){return e.uuid===t.uuid}));t&&t.length||r.push(e)})),r.forEach((function(e,t){e._id=t+1})),e.setState({data:r,selectedKeys:[]})}else e.setState({data:[],selectedKeys:[]})},e.cols=[{type:"checkbox"},{title:"\u884c\u53f7",field:"_id",width:60},{title:"\u6761\u7801\u53f7",field:"spec_code",width:120},{title:"\u79d1\u5ba4",field:"job_name",width:120},{title:"\u5c97\u4f4d",field:"project_name",width:120},{title:"\u72b6\u6001",field:"_status",width:70,render:function(e){var t=e.rows;return h.filterSelect([{name:"\u5df2\u4e0a\u67b6",value:"2"},{name:"\u4e0d\u53ef\u4e0a\u67b6",value:"3"},{name:"\u53ef\u4ee5\u4e0a\u67b6",value:"1"},{name:"\u5176\u4ed6\u79d1\u5ba4",value:"0"}],t._status,"name","value")}}],e}return Object(r.a)(n,[{key:"componentDidMount",value:function(){}},{key:"onChange",value:function(e){this.setState({sf_code:e})}},{key:"onChangeSpec",value:function(e){this.setState({spec_enter_value:e})}},{key:"render",value:function(){var e=this,t=this.state,n=t.data,s=t.pullLoading,r=t.sf_code,c=t.sf_data,i=t.infoLoading,l=t.spec_enter_value,o=t.selectedKeys,d=t.key;return Object(a.jsxs)(_,{title:"\u6807\u672c\u6279\u91cf\u4e0a\u67b6",children:[Object(a.jsxs)("div",{className:"fxm p10",children:["\u6807\u672c\u67b6\u4ee3\u7801\uff1a",Object(a.jsx)(j,{p:"\u8bf7\u8f93\u5165\u6807\u672c\u67b6\u4ee3\u7801",width:"160px",onChange:function(t){return e.onChange(t)},onPressEnter:function(t){return e.querySpecPlane(t)},value:r}),Object(a.jsx)(p,{label:"\u67e5\u8be2",disabled:!r||i,className:"ml10",ghost:!0,onClick:function(){return e.querySpecPlane()}}),Object(a.jsx)("div",{className:"ml20",children:this.sf_list.map((function(t,n){return Object(a.jsxs)(u.a.Fragment,{children:[Object(a.jsxs)("span",{className:"tit",children:[t.name,"\uff1a"]}),Object(a.jsx)("span",{className:"f13 b",children:c[t.field]}),e.sf_list.length>n+1&&Object(a.jsx)("span",{className:"f13 b mlr15",children:"|"})]},n)}))})]}),Object(a.jsxs)("div",{className:"ex plr10 fx",children:[Object(a.jsxs)("div",{className:"ex mr15 r4px fv",children:[Object(a.jsx)("div",{className:"plr5 mb5",style:{height:"28px",lineHeight:"28px",background:"rgba(242,242,242,1)"},children:"\u6761\u7801\u5f55\u5165"}),Object(a.jsx)("div",{className:"ex x_ssb_t1",style:{border:"1px solid #E8EAEC"},children:Object(a.jsx)(j,{p:"\u8bf7\u8f93\u5165\u6761\u7801",mode:"textarea",onChange:function(t){return e.onChangeSpec(t)},value:l})}),Object(a.jsx)("div",{className:"tc p10",style:{border:"1px solid #E8EAEC",borderTop:"none"},children:Object(a.jsx)(p,{label:"\u6821\u9a8c",onClick:function(){return e.fetch()}})})]}),Object(a.jsxs)("div",{className:"ex r4px fv",children:[Object(a.jsxs)("div",{className:"fxm plr5 mb5",style:{height:"28px",background:"rgba(242,242,242,1)"},children:[Object(a.jsx)("span",{className:"ex",children:"\u6761\u7801\u5217\u8868"}),Object(a.jsxs)("div",{children:[Object(a.jsx)(p,{className:"mr10",label:"\u5220\u9664",ghost:!0,disabled:!h.hasArray(o),onClick:function(){return e.deletes(1)}}),Object(a.jsx)(p,{label:"\u6e05\u7a7a",ghost:!0,disabled:!h.hasArray(n),onClick:function(){return e.deletes(2)}})]})]}),Object(a.jsx)(g,{style:{border:"1px solid #E8EAEC",borderTop:"none"},cols:this.cols,data:n,loading:s,onRow:function(t){return e.setState({selectedKeys:t})},onChange:function(t,n){return h.pageChange.call(e,{current:t,pageSize:n})}},d),Object(a.jsx)("div",{className:"tc p10",style:{border:"1px solid #E8EAEC",borderTop:"none"},children:Object(a.jsx)(p,{label:"\u4e0a\u67b6\u5b8c\u6210",onClick:function(){return e.onCompletion()}})})]})]})]})}}]),n}(u.a.Component)}}]);